#!/usr/bin/env bash
# hooks/git/post-commit - Log commits to world.log
# Works in both main repo and worktrees via core.hooksPath

set -euo pipefail

# Derive PROJECT_DIR from git common dir (works in worktrees)
GIT_COMMON_DIR="$(git rev-parse --git-common-dir)"
export PROJECT_DIR="$(dirname "$GIT_COMMON_DIR")"

# Only run if record.sh exists (we're in claude-code repo)
[ -f "$PROJECT_DIR/world/commands/record.sh" ] || exit 0

# Get commit info
COMMIT_HASH=$(git rev-parse --short HEAD)
COMMIT_MSG=$(git log -1 --pretty=format:"%s")
BRANCH=$(git branch --show-current)

# Record to world.log (include branch for visibility)
"$PROJECT_DIR/world/commands/record.sh" "git:commit" "[$BRANCH] $COMMIT_HASH: $COMMIT_MSG"
